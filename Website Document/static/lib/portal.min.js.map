{"version":3,"sources":["portal.js"],"names":["window","Portal","activeApplication","portal","this","$sidebarMiddle","$","document","find","$sidebarAppBase","removeClass","remove","$portalContent","$portalContentLoading","$portalContentLoadingTitle","applications","Object","defineProperties","value","get","onAppAdd","intell","createEventFunction","onAppLoad","scripts","openApplication","application","mainfest","status","show","html","title","url","Promise","resolve","reject","load","error","send","loadHtml","then","request","$all","responseText","length","append","root","urls","Array","isArray","filted_urls","filter","indexOf","promises","forEach","index","push","jQuery","getScript","cache","done","fail","all","prototype","apply","catch","err","loadScript","js","loadApplication","hide","name","console","log","addApplication","app","pinned","$sidebar","clone","sidebar","icon","css","shortcut","startup","addClass","on","$this","item","parent","PortalApplication","undefined","loaded","statusName","onShow","onHide"],"mappings":"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","file":"portal.min.js","sourcesContent":["\r\n/** @class */\r\nwindow.Portal = function() {\r\n\r\n    /** @type {Portal} */\r\n    var portal = this;\r\n    \r\n    \r\n    var $sidebarMiddle = $(document).find('.sidebar-middle');\r\n    var $sidebarAppBase = $sidebarMiddle.find('.sidebar-app.BASE-CONTROL').removeClass('BASE-CONTROL').remove(); \r\n    var $portalContent = $(document).find('.portal-content');                   //.portal-content\r\n    var $portalContentLoading = $portalContent.find('.portal-content-loading'); //.portal-content .portal-content-loading\r\n    var $portalContentLoadingTitle = $portalContentLoading.find('>.title');     //.portal-content .portal-content-loading .icon\r\n\r\n    //properties\r\n    var applications = [];\r\n    var activeApplication;\r\n\r\n    \r\n    Object.defineProperties(this, {\r\n        applications: { value: applications },\r\n        activeApplication: {\r\n            get: function() { return activeApplication; }\r\n        },\r\n    });\r\n\r\n    //events\r\n    var onAppAdd = this.onAppAdd = intell.createEventFunction();\r\n    var onAppLoad = this.onAppLoad = intell.createEventFunction();\r\n\r\n    // private fields\r\n    var scripts = []; // loaded script\r\n\r\n    \r\n    \r\n    /////////////////////\r\n    // public function\r\n    /////////////////////\r\n\r\n    portal.addApplication = addApplication;\r\n    portal.openApplication = openApplication;\r\n\r\n    /** @param {PortalApplication} app */\r\n    function addApplication(app) {\r\n        var mainfest = app.mainfest;\r\n        \r\n\r\n        if (mainfest.pinned == true) {\r\n            var $sidebar = $sidebarAppBase.clone();\r\n            var sidebar = $sidebar[0];\r\n\r\n            sidebar.application = app;\r\n            sidebar.mainfest = mainfest;\r\n\r\n            if (mainfest.icon) $sidebar.find('.icon').css('background-image', 'url(\"' + mainfest.icon + '\")');\r\n            $sidebar.find('.name').html(mainfest.name);\r\n            sidebar.title = mainfest.title;\r\n\r\n            app.shortcut = sidebar;\r\n\r\n            $sidebarMiddle.append($sidebar);\r\n        }\r\n        if (mainfest.startup == true) {\r\n            openApplication(app);\r\n\r\n            if ($sidebar) $sidebar.addClass('ACTIVE');\r\n        }\r\n\r\n        applications.push(app);\r\n        onAppAdd(app);\r\n    }\r\n\r\n    /** @param {PortalApplication} application */\r\n    function openApplication(application) {\r\n\r\n        var mainfest = application.mainfest;\r\n\r\n        activeApplication = application; // set current application\r\n        \r\n\r\n        if (application.status == 0) { //NONE: application never load before\r\n            \r\n\r\n            $portalContentLoading.show();\r\n            $portalContentLoadingTitle.html(mainfest.title);\r\n\r\n            application.status = 1;\r\n\r\n            loadApplication(application).then(function() {\r\n                // this is asynchronous action when code reach here, user may open another apps\r\n\r\n                $portalContent.append(application.root);\r\n                application.status = 2;\r\n                onAppLoad(application);\r\n                \r\n                if (activeApplication == application) {\r\n                    $portalContentLoading.hide();\r\n                    $(application.root).show();\r\n                }\r\n                else $(application.root).hide();\r\n\r\n            }).catch(function(error) {\r\n                application.status = 3;\r\n\r\n                $portalContentLoading.show();\r\n                $portalContentLoadingTitle.html(\"Error while load \" + mainfest.name);\r\n\r\n                console.log('Portal error:', error);\r\n                ///throw error;\r\n            });\r\n\r\n        }\r\n        else if (application.status == 1) { //LOADING: application is loading\r\n            $portalContentLoading.show();\r\n            $portalContentLoadingTitle.html(mainfest.title);\r\n\r\n        }\r\n        else if (application.status == 2) { //LOADED\r\n            $portalContentLoading.hide();\r\n            $(application.root).show();\r\n        }\r\n        else if (application.status == 3) { //FAIL\r\n            $portalContentLoading.show();\r\n            $portalContentLoadingTitle.html(\"Error while load \" + mainfest.name);\r\n\r\n            //throw \"Not implement\";\r\n        }\r\n    }\r\n\r\n    /////////////////////\r\n    // private function\r\n    /////////////////////\r\n\r\n    /** @param {string} urls @returns {Promise<XMLHttpRequest>}  */\r\n    function loadHtml(url) {\r\n        if (!url) return Promise.resolve(null);        \r\n\r\n        return new Promise(function(resolve, reject) {\r\n            intell.get(url).load(function() {\r\n                resolve(this);\r\n            }).error(function() {\r\n                reject(this);\r\n            }).send();\r\n        });\r\n    };\r\n\r\n    /** @param {string[]} urls @returns {Promise<XMLHttpRequest>}  */\r\n    function loadScript(urls) {\r\n        if (Array.isArray(urls) == false) urls = [urls];\r\n\r\n\r\n        var filted_urls = urls.filter(function(value) {\r\n            return scripts.indexOf(value) == -1;\r\n        });\r\n\r\n        return new Promise(function(resolve, reject) {\r\n            var promises = [];\r\n\r\n            filted_urls.forEach(function(value, index) {\r\n\r\n                promises.push(new Promise(function(resolve, reject) {\r\n                    jQuery.getScript({ url: value, cache: true }).done(function() {\r\n                        resolve();\r\n                    }).fail(function() {\r\n                        reject(\"Can't find \" + value);\r\n                    });\r\n                }));\r\n            });\r\n\r\n            Promise.all(promises).then(function() {\r\n                Array.prototype.push.apply(scripts, filted_urls);\r\n                \r\n                resolve();\r\n            }).catch(function(err) {\r\n                reject(err);\r\n            });\r\n\r\n        });\r\n\r\n    }\r\n\r\n    /** @param {PortalApplication} application; @returns {Promise<XMLHttpRequest>} */\r\n    function loadApplication(application) {\r\n        var mainfest = application.mainfest;\r\n        \r\n        return loadHtml(mainfest.html).then(function(request) {\r\n            if (request != null) {\r\n                var $all = $(request.responseText);\r\n                if ($all.length > 1) $all = $('<div></div>').append($all);\r\n                application.root = $all[0];\r\n            }\r\n\r\n            return loadScript(mainfest.js);\r\n        }).then(function() {\r\n            return application.load();\r\n        });\r\n    }\r\n\r\n\r\n\r\n    \r\n\r\n    $sidebarMiddle.on('click', '.sidebar-app', function() {\r\n        var $this = $(this);\r\n        var application = this.application;\r\n\r\n        portal.applications.forEach(function(item) { $(item.root).hide() });\r\n        portal.openApplication(application);\r\n\r\n        $this.parent().find('>.sidebar-app.ACTIVE').removeClass('ACTIVE');\r\n        $this.addClass('ACTIVE');\r\n    });\r\n}\r\nwindow.PortalApplication = function PortalApplication() {\r\n    if (this instanceof PortalApplication == false) return new PortalApplication();\r\n\r\n    this.mainfest = {\r\n        name: undefined,\r\n        icon: undefined,\r\n\r\n        html: undefined,\r\n        css: [],\r\n        js: [],\r\n        pinned: true,\r\n        startup: false,\r\n    };\r\n\r\n    \r\n    this.status = 0;\r\n\r\n    this.loaded = false;\r\n\r\n    this.load = function() { }\r\n\r\n\r\n    Object.defineProperties(this, {\r\n        statusName: {\r\n            get: function() {\r\n                var status = this.status;\r\n                if (status == 0) return \"NONE\";\r\n                else if (status == 1) return \"LOADING\";\r\n                else if (status == 2) return \"LOADED\";\r\n                else if (status == 3) return \"FAIL\";\r\n                \r\n            },\r\n        }\r\n    });\r\n\r\n\r\n    this.onShow = intell.createEventFunction(false);\r\n    this.onHide = intell.createEventFunction(false);\r\n}"]}