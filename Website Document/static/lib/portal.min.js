"use strict";
/*! portal.js | @ license | https://github.com/XHighIntell/jintell */window.Portal=function(n){var s=this,i=$(n),e=i.find(".portal-content");s.sidebar=new function(){var o=this,t=i.find(".sidebar"),a=i.find(".sidebar .sidebar-middle"),n=i.find(".sidebar .sidebar-top"),r=i.find(".sidebar .sidebar-middle .sidebar-app.BASE-CONTROL").removeClass("BASE-CONTROL").remove();o.add=function(n){var t=r.clone(),i=t[0],e=n.manifest;return t.attr("title",e.title),e.icon&&t.find(".icon").css("background-image",'url("'+e.icon+'")'),t.find(".name").html(e.name),o.setApplication(i,n),a.append(t),i},o.get=function(t){return a.find(">.sidebar-app").toArray().find(function(n){return o.getApplication(n)==t})},o.active=function(n){var t=o.get(n);if(null!=t)return a.find(">.sidebar-app").each(function(){this==t?$(this).addClass("ACTIVE"):$(this).removeClass("ACTIVE")}),t},o.getApplication=function(n){return n._application},o.setApplication=function(n,t){n._application=t},n.find(".collapse-button").click(function(){var n=t.toggleClass("collapsed").is(".collapsed");localStorage.setItem("portal.sidebar.collapsed",n)}),a.on("click",".sidebar-app",function(){var n=o.getApplication(this);n&&s.open(n)}),"true"==localStorage.getItem("portal.sidebar.collapsed")&&t.addClass("collapsed")};var o,a=s.overlay=new function(){var n=this,t=e.find(".Loading-Overlay"),i=e.find(".Error-Overlay");n.showLoading=function(n){t.find(".Application-Name").text(n.manifest.name),t.find(".Application-Description").text(n.manifest.description),t.show(),i.hide()},n.showError=function(n){i.find(".Application-Name").html(n.manifest.name),i.find(".Message").html(n.error.message),i.find(".Stack").html(n.error.stack),i.show(),t.hide()},n.hide=function(){t.hide(),i.hide()}},r=[],c=s.jsUrls=[];Object.defineProperties(s,{applications:{get:function(){return r}},activeApplication:{get:function(){return o}}}),s.add=function(n){var t=n.manifest,i=s.sidebar.get(n);null==i&&(r.push(n),1==t.shortcut&&(i=s.sidebar.add(n)))},s.open=function(t){t.manifest;if(o!=t){var n=o,i=t;o=t,s.sidebar.active(t),s.applications.forEach(function(n){$(n.root).hide()}),"NONE"==t.status?(a.showLoading(t),s.load(t).then(function(){e.append(t.root),o==t?(a.hide(),$(t.root).show()):$(t.root).hide()},function(n){o==t&&a.showError(t)})):"LOADING"==t.status?a.showLoading(t):"LOADED"==t.status?(a.hide(),$(t.root).show()):"FAIL"==t.status&&a.showError(t),s.sidebar.active(t),s.onchange({oldApplication:n,newApplication:i})}},s.contains=function(n){return-1!=r.indexOf(n)},s.load=function(i){if("NONE"!=i.status)throw"Application is already loaded";i.status="LOADING";var a=i.manifest,n=Promise.resolve();return a.content.html&&(n=n.then(function(){return new Promise(function(t,n){intell.get(a.content.html).load(function(){var n=$(this.responseText);1<n.length&&(n=$("<div></div>").append(n)),i.root=n[0],t()}).error(function(){n("ERR_INTERNET_DISCONNECTED")}).send()})})),a.content.js&&0<a.content.js.length&&(n=n.then(function(){return new Promise(function(i,e){var o=Array.from(a.content.js);!function n(){var t=o.shift();if(null==t)return void i();s.loadJavascript(t).then(function(){n()},function(n){e(n)})}()})})),n.then(function(){if("function"==typeof i.load)return i.load()}).then(function(){i.status="LOADED"}).catch(function(n){return i.status="FAIL",i.error=n,console.error(n),Promise.reject(n)})},s.loadJavascript=function(i){var e=new URL(i,document.baseURI);return-1!=c.indexOf(e.href)?Promise.resolve():new Promise(function(n,t){return $.getScript({url:e.href,cache:!0}).done(function(){c.push(e.href),n()}).fail(function(){t(new Error("Can't load javascript: "+i))})})},s.onchange=intell.createEventFunction(),$(document).ready(function(){var n,t=intell.qs();t.app&&(n=r.find(function(n){return n.manifest.id==t.app})),null==n&&(n=r.find(function(n){return 1==n.manifest.startup}))&&s.open(n),s.open(n)}),s.onchange(function(n){console.log("portal.onchange",n);var t=intell.qs();t.app=n.newApplication.manifest.id;var i="?"+Object.getOwnPropertyNames(t).map(function(n){return n+"="+t[n]}).join("&");history.pushState(null,document.title,i)})},window.PortalApplication=function(n){this.manifest={id:"",icon:"",name:"",title:"",description:"",content:{js:[],css:[],html:""},shortcut:!0,startup:!1},this.status="NONE"};
//# sourceMappingURL=portal.min.js.map