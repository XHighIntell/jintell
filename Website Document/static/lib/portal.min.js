window.Portal=function(){var t,i=this,o=$(document).find(".sidebar-middle"),a=o.find(".sidebar-app.BASE-CONTROL").removeClass("BASE-CONTROL").remove(),e=$(document).find(".portal-content"),r=e.find(".portal-content-loading"),s=r.find(">.title"),c=[];Object.defineProperties(this,{applications:{value:c},activeApplication:{get:function(){return t}}});var l=this.onAppAdd=intell.createEventFunction(),u=this.onAppLoad=intell.createEventFunction(),d=[];function p(n){var i=n.mainfest;0==(t=n).status?(r.show(),s.html(i.title),n.status=1,function(i){var e=i.mainfest;return function(i){return i?new Promise(function(t,n){intell.get(i).load(function(){t(this)}).error(function(){n(this)}).send()}):Promise.resolve(null)}(e.html).then(function(t){if(null!=t){var n=$(t.responseText);1<n.length&&(n=$("<div></div>").append(n)),i.root=n[0]}return function(t){0==Array.isArray(t)&&(t=[t]);var i=t.filter(function(t){return-1==d.indexOf(t)});return new Promise(function(t,n){var e=[];i.forEach(function(i,t){e.push(new Promise(function(t,n){jQuery.getScript({url:i,cache:!0}).done(function(){t()}).fail(function(){n()})}))}),Promise.all(e).then(function(){Array.prototype.push.apply(d,i),t()}).catch(function(){n()})})}(e.js)}).then(function(){return i.load()})}(n).then(function(){e.append(n.root),n.status=2,u(n),t==n?(r.hide(),$(n.root).show()):$(n.root).hide()}).catch(function(t){throw n.status=3,r.show(),s.html("Error while load "+i.name),t})):1==n.status?(r.show(),s.html(i.title)):2==n.status?(r.hide(),$(n.root).show()):3==n.status&&(r.show(),s.html("Error while load "+i.name))}i.addApplication=function(t){var n=t.mainfest;if(1==n.pinned){var i=a.clone(),e=i[0];e.application=t,(e.mainfest=n).icon&&i.find(".icon").css("background-image",'url("'+n.icon+'")'),i.find(".name").html(n.name),e.title=n.title,t.shortcut=e,o.append(i)}1==n.startup&&(p(t),i&&i.addClass("ACTIVE"));c.push(t),l(t)},i.openApplication=p,o.on("click",".sidebar-app",function(){var t=$(this),n=this.application;i.applications.forEach(function(t){$(t.root).hide()}),i.openApplication(n),t.parent().find(">.sidebar-app.ACTIVE").removeClass("ACTIVE"),t.addClass("ACTIVE")})},window.PortalApplication=function t(){if(this instanceof t==0)return new t;this.mainfest={name:void 0,icon:void 0,html:void 0,css:[],js:[],pinned:!0,startup:!1},this.status=0,this.loaded=!1,this.load=function(){},Object.defineProperties(this,{statusName:{get:function(){var t=this.status;return 0==t?"NONE":1==t?"LOADING":2==t?"LOADED":3==t?"FAIL":void 0}}}),this.onShow=intell.createEventFunction(!1),this.onHide=intell.createEventFunction(!1)};
//# sourceMappingURL=portal.min.js.map
