/*! jIntell Framework - Portal.js 
* 
* https://github.com/XHighIntell/jintell */
"use strict";window.Portal=function(n){if(null==n)throw new Error("Failed to construct 'Portal': element can't be null.");var c=this,e=$(n),s=e.find(".Portal-Content"),a=s.find(".Portal-Applications");0==s.length&&(s=$('<main class="Portal-Content"></main>').appendTo(e)),0==a.length&&(a=$('<div class="Portal-Applications"></div>').appendTo(s)),c.sidebar=new function(){var i="Shortcut",a=this,t=e.find(".Sidebar"),n=t.find(".Sidebar-Top"),o=t.find(".Sidebar-Middle"),r=o.find("."+i+".abstract").removeClass("abstract").remove(),l=o.find(".Group.abstract").removeClass("abstract").remove();0==t.length&&(t=$('<div class="Sidebar"></div>').insertBefore(s)),n.length,0==o.length&&(o=$('<div class="Sidebar-Middle"></div>').appendTo(t)),0==r.length&&(r=$('<div class="Shortcut" title="" tabindex="0">\n    <i class="Icon"></i>\n    <span class="Name"></span>\n</div>')),0==l.length&&(l=$('<div class="Group" data-group="">\n    <header>\n        <div class="Name"></div>\n    </header>\n    <div class="Apps">\n                        \n    </div>\n</div>')),a.keys={},a.add=function(n){var t=r.clone(),i=t[0],e=n.manifest;if(t.attr("title",e.title),e.icon?t.find(".Icon").css("background-image",'url("'+e.icon+'")'):e.iconText&&t.find(".Icon").html(e.iconText),t.find(".Name").html(e.name),a.setApplication(i,n),e.group){if(0==(s=o.find('.Group[data-group="'+e.group+'"]')).length)(s=l.clone()).attr("data-group",e.group),s.find(">header>.Name").html(e.group),o.append(s);s.find(".Apps").append(t)}else{var s;(s=o.find(".Group:first")).length?t.insertBefore(s):o.append(t)}return i},a.get=function(t){return o.find("."+i).toArray().find(function(n){return a.getApplication(n)==t})},a.active=function(n){var t=a.get(n);if(null!=t)return o.find("."+i).each(function(){this==t?$(this).addClass("ACTIVE"):$(this).removeClass("ACTIVE")}),t},a.getApplication=function(n){return n._application},a.setApplication=function(n,t){n._application=t},a.enableCollapseStorage=function(n){a.keys.collapsed=n,a.keys.collapsed&&"true"==localStorage.getItem(n)&&t.addClass("COLLAPSED")},n.find(".Collapse-Button:first").click(function(){var n=t.toggleClass("COLLAPSED").is(".COLLAPSED");a.keys.collapsed&&localStorage.setItem(a.keys.collapsed,n)}),o.on("click","."+i,function(){var n=a.getApplication(this);n&&c.open(n)})};var o,r=c.overlay=new function(){var n=this,t=s.find(".Loading-Overlay"),i=s.find(".Error-Overlay");n.showLoading=function(n){t.find(".Application-Name").text(n.manifest.name),t.find(".Application-Description").text(n.manifest.description),t.show(),t[0].offsetHeight,t.addClass("ACTIVE"),i.hide()},n.showError=function(n){i.find(".Application-Name").html(n.manifest.name),i.find(".Message").html(n.error.message),i.find(".Stack").html(n.error.stack),i.show(),t.hide()},n.hide=function(){t.hide().removeClass("ACTIVE"),i.hide().removeClass("ACTIVE")},0==t.length&&(t=$('<div class="Loading-Overlay" style="display:none">\n    <i class="spring"></i>\n    <div class="content">\n        <i class="spring"></i>\n        <div class="Application-Name"></div>\n        <div class="Application-Description"></div>\n        <i class="spring" style="flex-grow:1.5"></i>\n    </div>\n                \n    <i class="spring"></i>\n    <div class="waiting-box">\n        <div class="cycle"></div>\n        <div class="cycle" style="animation-delay:.15s"></div>\n        <div class="cycle" style="animation-delay:.3s"></div>\n        <div class="cycle" style="animation-delay:.45s"></div>\n        <div class="cycle" style="animation-delay:.6s"></div>\n    </div>\n</div>'),s.prepend(t)),0==i.length&&(i=$('<div class="Error-Overlay" style="display:none">\n    <i class="spring"></i>\n    <div>\n        <i class="spring"></i>\n        <div class="header">\n            <div class="icon">âœ–</div>\n            <div>\n                <div class="Application-Name"></div>\n                <div class="Message"></div>\n            </div>\n        </div>\n        <div class="Stack"></div>\n        <i class="spring" style="flex-grow:1.5"></i>\n    </div>\n    <i class="spring"></i>\n</div>'),s.prepend(i))},l=[],d=c.jsUrls=[],u=c.styleUrls=[];Object.defineProperties(c,{applications:{get:function(){return l}},activeApplication:{get:function(){return o}}}),c.add=function(n){var t=n.manifest;null==c.sidebar.get(n)&&(l.push(n),1==t.shortcut&&(n.shortcut=c.sidebar.add(n)))},c.addManifest=function(n,t){var i=new PortalApplication;return null!=n.id&&(i.manifest.id=n.id),null!=n.name&&(i.manifest.name=n.name),null!=n.description&&(i.manifest.description=n.description),null!=n.title&&(i.manifest.title=n.title),null!=n.icon&&(i.manifest.icon=n.icon),null!=n.iconText&&(i.manifest.iconText=n.iconText),null!=n.shortcut&&(i.manifest.shortcut=n.shortcut),null!=n.group&&(i.manifest.group=n.group),null!=n.startup&&(i.manifest.startup=n.startup),null!=n.content&&(null!=n.content.html&&(i.manifest.content.html=n.content.html),null!=n.content.js&&(i.manifest.content.js=n.content.js),null!=n.content.css&&(i.manifest.content.css=n.content.css)),i.load=function(){return t(i)},c.add(i),i},c.open=function(t){if(null==t)(t=l.find(function(n){return 1==n.manifest.startup}))&&c.open(t);else if(t instanceof PortalApplication){t.manifest;if(o==t)return;var n=o,i=t;o=t,c.sidebar.active(t),c.applications.forEach(function(n){$(n.root).hide()}),"NONE"==t.status?(r.showLoading(t),c.load(t).then(function(){a.append(t.root),o==t?(r.hide(),$(t.root).show()):$(t.root).hide(),t.onopen()},function(n){o==t&&r.showError(t)})):"LOADING"==t.status?r.showLoading(t):"LOADED"==t.status?(r.hide(),$(t.root).show()):"FAIL"==t.status&&r.showError(t),c.sidebar.active(t),c.onchange({oldApplication:n,newApplication:i}),"LOADED"==t.status&&t.onopen()}else if("string"==typeof t){var e=t;e&&(t=l.find(function(n){return n.manifest.id==e})),t?c.open(t):c.open()}},c.contains=function(n){return-1!=l.indexOf(n)},c.load=function(e){if("NONE"!=e.status)throw"Application is already loaded";e.status="LOADING";var a=e.manifest,n=Promise.resolve();return a.content.html&&(n=n.then(function(){return new Promise(function(t,i){intell.get(a.content.html).load(function(){if(200==this.status){var n=$(this.responseText);1<n.length&&(n=$("<div></div>").append(n)),e.root=n[0],t()}else i(new Error("Can't load html: "+a.content.html))}).error(function(){i(new Error("ERR_INTERNET_DISCONNECTED"))}).send()})})),a.content.js&&0<a.content.js.length&&(n=n.then(function(){return new Promise(function(i,e){var s=Array.from(a.content.js);!function n(){var t=s.shift();if(null==t)return void i();c.loadJavascript(t).then(function(){n()},function(n){e(n)})}()})})),a.content.css&&0<a.content.css.length&&a.content.css.forEach(function(n){c.loadStyle(n)}),n.then(function(){if("function"==typeof e.load)return e.load()}).then(function(){e.status="LOADED"}).catch(function(n){return e.status="FAIL",e.error=n,console.error(n),Promise.reject(n)})},c.loadJavascript=function(i){var e=new URL(i,document.baseURI);return-1!=d.indexOf(e.href)?Promise.resolve():new Promise(function(n,t){return $.getScript({url:e.href,cache:!0}).done(function(){d.push(e.href),n()}).fail(function(){t(new Error("Can't load javascript: "+i))})})},c.loadStyle=function(n){var e=new URL(n,document.baseURI);return-1!=u.indexOf(e.href)?Promise.resolve():new Promise(function(n,t){var i=$('<link href="/static/css/hljs.css" rel="stylesheet">');document.head.append(i[0]),u.push(e.href),n()})},c.onchange=intell.createEventFunction()},window.PortalApplication=function(n){this.manifest={id:"",icon:"",iconText:"",name:"",title:"",description:"",content:{js:[],css:[],html:""},shortcut:!0,startup:!1},this.status="NONE",this.onopen=intell.createEventFunction()};
//# sourceMappingURL=portal.min.js.map