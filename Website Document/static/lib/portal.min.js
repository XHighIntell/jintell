/*! jIntell Framework - Portal.js 
* 
* https://github.com/XHighIntell/jintell */
"use strict";window.Portal=function(n){var l=this,i=$(n),s=i.find(".Portal-Content");l.sidebar=new function(){var a=this,t=i.find(".Sidebar"),n=t.find(".Sidebar-Top"),o=t.find(".Sidebar-Middle"),r=o.find(".Sidebar-App.abstract").removeClass("abstract").remove(),c=o.find(".Group.abstract").removeClass("abstract").remove();0==r.length&&(r=$('<div class="Sidebar-App abstract" title="" tabindex="0">\n    <i class="Icon"></i>\n    <span class="Name"></span>\n</div>')),0==c.length&&(c=$('<div class="Group" data-group="Account">\n    <header>\n        <div class="Name">Account</div>\n    </header>\n    <div class="Apps">\n                        \n    </div>\n</div>')),a.keys={},a.add=function(n){var t=r.clone(),i=t[0],e=n.manifest;if(t.attr("title",e.title),e.icon&&t.find(".Icon").css("background-image",'url("'+e.icon+'")'),t.find(".Name").html(e.name),a.setApplication(i,n),e.group){if(0==(s=o.find('.Group[data-group="'+e.group+'"]')).length)(s=c.clone()).attr("data-group",e.group),s.find(">header>.Name").html(e.group),o.append(s);s.find(".Apps").append(t)}else{var s;(s=o.find(".Group:first")).length?t.insertBefore(s):o.append(t)}return i},a.get=function(t){return o.find(".Sidebar-App").toArray().find(function(n){return a.getApplication(n)==t})},a.active=function(n){var t=a.get(n);if(null!=t)return o.find(".Sidebar-App").each(function(){this==t?$(this).addClass("ACTIVE"):$(this).removeClass("ACTIVE")}),t},a.getApplication=function(n){return n._application},a.setApplication=function(n,t){n._application=t},a.enableCollapseStorage=function(n){a.keys.collapsed=n,a.keys.collapsed&&"true"==localStorage.getItem(n)&&t.addClass("collapsed")},n.find(".collapse-button:first").click(function(){var n=t.toggleClass("collapsed").is(".collapsed");a.keys.collapsed&&localStorage.setItem(a.keys.collapsed,n)}),o.on("click",".Sidebar-App",function(){var n=a.getApplication(this);n&&l.open(n)})};var a,o=l.overlay=new function(){var n=this,t=s.find(".Loading-Overlay"),i=s.find(".Error-Overlay");n.showLoading=function(n){t.find(".Application-Name").text(n.manifest.name),t.find(".Application-Description").text(n.manifest.description),t.show(),t[0].offsetHeight,t.addClass("ACTIVE"),i.hide()},n.showError=function(n){i.find(".Application-Name").html(n.manifest.name),i.find(".Message").html(n.error.message),i.find(".Stack").html(n.error.stack),i.show(),t.hide()},n.hide=function(){t.hide().removeClass("ACTIVE"),i.hide().removeClass("ACTIVE")},0==t.length&&(t=$('<div class="Loading-Overlay" style="display:none">\n    <i class="spring"></i>\n    <div class="content">\n        <i class="spring"></i>\n        <div class="Application-Name"></div>\n        <div class="Application-Description"></div>\n        <i class="spring" style="flex-grow:1.5"></i>\n    </div>\n                \n    <i class="spring"></i>\n    <div class="Waiting-Box">\n        <div class="cycle"></div>\n        <div class="cycle" style="animation-delay:.15s"></div>\n        <div class="cycle" style="animation-delay:.3s"></div>\n        <div class="cycle" style="animation-delay:.45s"></div>\n        <div class="cycle" style="animation-delay:.6s"></div>\n    </div>\n</div>'),s.append(t)),0==i.length&&(i=$('<div class="Error-Overlay" style="display:none">\n    <i class="spring"></i>\n    <div>\n        <i class="spring"></i>\n        <div class="header">\n            <div class="icon">âœ–</div>\n            <div>\n                <div class="Application-Name"></div>\n                <div class="Message"></div>\n            </div>\n        </div>\n        <div class="Stack"></div>\n        <i class="spring" style="flex-grow:1.5"></i>\n    </div>\n    <i class="spring"></i>\n</div>'),s.append(i))},r=[],c=l.jsUrls=[],d=l.styleUrls=[];Object.defineProperties(l,{applications:{get:function(){return r}},activeApplication:{get:function(){return a}}}),l.add=function(n){var t=n.manifest;null==l.sidebar.get(n)&&(r.push(n),1==t.shortcut&&(n.shortcut=l.sidebar.add(n)))},l.addManifest=function(n,t){var i=new PortalApplication;null!=n.id&&(i.manifest.id=n.id),null!=n.name&&(i.manifest.name=n.name),null!=n.description&&(i.manifest.description=n.description),null!=n.title&&(i.manifest.title=n.title),null!=n.icon&&(i.manifest.icon=n.icon),null!=n.shortcut&&(i.manifest.shortcut=n.shortcut),null!=n.group&&(i.manifest.group=n.group),null!=n.startup&&(i.manifest.startup=n.startup),null!=n.content&&(null!=n.content.html&&(i.manifest.content.html=n.content.html),null!=n.content.js&&(i.manifest.content.js=n.content.js),null!=n.content.css&&(i.manifest.content.css=n.content.css)),i.load=function(){return t(i)},l.add(i)},l.open=function(t){if(null==t)(t=r.find(function(n){return 1==n.manifest.startup}))&&l.open(t);else if(t instanceof PortalApplication){t.manifest;if(a==t)return;var n=a,i=t;a=t,l.sidebar.active(t),l.applications.forEach(function(n){$(n.root).hide()}),"NONE"==t.status?(o.showLoading(t),l.load(t).then(function(){s.append(t.root),a==t?(o.hide(),$(t.root).show()):$(t.root).hide(),t.onopen()},function(n){a==t&&o.showError(t)})):"LOADING"==t.status?o.showLoading(t):"LOADED"==t.status?(o.hide(),$(t.root).show()):"FAIL"==t.status&&o.showError(t),l.sidebar.active(t),l.onchange({oldApplication:n,newApplication:i}),"LOADED"==t.status&&t.onopen()}else if("string"==typeof t){var e=t;e&&(t=r.find(function(n){return n.manifest.id==e})),t?l.open(t):l.open()}},l.contains=function(n){return-1!=r.indexOf(n)},l.load=function(e){if("NONE"!=e.status)throw"Application is already loaded";e.status="LOADING";var a=e.manifest,n=Promise.resolve();return a.content.html&&(n=n.then(function(){return new Promise(function(t,i){intell.get(a.content.html).load(function(){if(200==this.status){var n=$(this.responseText);1<n.length&&(n=$("<div></div>").append(n)),e.root=n[0],t()}else i(new Error("Can't load html: "+a.content.html))}).error(function(){i(new Error("ERR_INTERNET_DISCONNECTED"))}).send()})})),a.content.js&&0<a.content.js.length&&(n=n.then(function(){return new Promise(function(i,e){var s=Array.from(a.content.js);!function n(){var t=s.shift();if(null==t)return void i();l.loadJavascript(t).then(function(){n()},function(n){e(n)})}()})})),a.content.css&&0<a.content.css.length&&a.content.css.forEach(function(n){l.loadStyle(n)}),n.then(function(){if("function"==typeof e.load)return e.load()}).then(function(){e.status="LOADED"}).catch(function(n){return e.status="FAIL",e.error=n,console.error(n),Promise.reject(n)})},l.loadJavascript=function(i){var e=new URL(i,document.baseURI);return-1!=c.indexOf(e.href)?Promise.resolve():new Promise(function(n,t){return $.getScript({url:e.href,cache:!0}).done(function(){c.push(e.href),n()}).fail(function(){t(new Error("Can't load javascript: "+i))})})},l.loadStyle=function(n){var e=new URL(n,document.baseURI);return-1!=d.indexOf(e.href)?Promise.resolve():new Promise(function(n,t){var i=$('<link href="/static/css/hljs.css" rel="stylesheet">');document.head.append(i[0]),d.push(e.href),n()})},l.onchange=intell.createEventFunction()},window.PortalApplication=function(n){this.manifest={id:"",icon:"",name:"",title:"",description:"",content:{js:[],css:[],html:""},shortcut:!0,startup:!1},this.status="NONE",this.onopen=intell.createEventFunction()};
//# sourceMappingURL=portal.min.js.map